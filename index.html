<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Simple M3U Playlist Viewer</title>
  <style>
    :root{--bg:#0f172a;--card:#0b1220;--muted:#94a3b8;--accent:#7c3aed}
    body{font-family:Inter,system-ui,Segoe UI,Roboto,"Helvetica Neue",Arial;background:linear-gradient(180deg,#071029 0%,#0b1220 100%);color:#e6eef8;margin:0;padding:24px}
    .wrap{max-width:1100px;margin:0 auto}
    header{display:flex;align-items:center;gap:16px;margin-bottom:18px}
    h1{font-size:20px;margin:0}
    p.lead{margin:0;color:var(--muted);font-size:13px}
    .controls{display:grid;grid-template-columns:1fr 220px;gap:12px;margin:18px 0}
    textarea{width:100%;height:180px;padding:12px;border-radius:10px;border:1px solid rgba(255,255,255,0.04);background:rgba(255,255,255,0.02);color:inherit;resize:vertical}
    button{background:var(--accent);border:none;color:white;padding:10px 12px;border-radius:8px;cursor:pointer}
    .toolbar{display:flex;gap:8px;align-items:center}
    .filters{display:flex;gap:8px;flex-wrap:wrap}
    .grid{display:grid;grid-template-columns:repeat(auto-fill,minmax(260px,1fr));gap:12px;margin-top:14px}
    .card{background:linear-gradient(180deg,rgba(255,255,255,0.02),rgba(255,255,255,0.01));padding:12px;border-radius:10px;border:1px solid rgba(255,255,255,0.03);display:flex;gap:12px;align-items:center}
    .logo{width:64px;height:64px;border-radius:8px;background:#071226;display:flex;align-items:center;justify-content:center;overflow:hidden}
    .logo img{width:100%;height:100%;object-fit:cover}
    .meta{flex:1}
    .title{font-weight:600}
    .sub{color:var(--muted);font-size:13px}
    .actions{display:flex;gap:8px;align-items:center}
    .pill{background:rgba(255,255,255,0.03);padding:6px 8px;border-radius:999px;font-size:12px;color:var(--muted)}
    .search{padding:8px;border-radius:8px;border:1px solid rgba(255,255,255,0.04);background:transparent;color:inherit}
    footer{color:var(--muted);font-size:12px;margin-top:20px}
    .muted{color:var(--muted)}
    .empty{padding:28px;border-radius:10px;border:1px dashed rgba(255,255,255,0.04);text-align:center;color:var(--muted)}
    @media (max-width:640px){.controls{grid-template-columns:1fr}}
    /* modal */
    .modal{position:fixed;inset:0;display:none;align-items:center;justify-content:center;background:rgba(3,6,12,0.6)}
    .modal.show{display:flex}
    .modal-card{background:var(--card);padding:16px;border-radius:12px;max-width:720px;width:100%;box-shadow:0 8px 32px rgba(0,0,0,0.6)}
    input[type=text]{width:100%;padding:8px;border-radius:8px;border:1px solid rgba(255,255,255,0.04);background:transparent;color:inherit}
    .small{font-size:12px;color:var(--muted)}
  </style>
</head>
<body>
  <div class="wrap">
    <header>
      <div>
        <h1>Simple M3U Playlist Viewer</h1>
        <p class="lead">Paste your M3U content below. This tool <strong>will not</strong> save/play any DRM or copyrighted keys/streams — it only parses metadata (names, logos, groups).</p>
      </div>
    </header>

    <div class="controls">
      <textarea id="m3uInput" placeholder="Paste your M3U content here (example: the #EXTINF lines)."></textarea>
      <div style="display:flex;flex-direction:column;gap:8px;">
        <button id="parseBtn">Parse M3U</button>
        <div style="background:rgba(255,255,255,0.02);padding:10px;border-radius:10px">
          <div style="font-weight:600">Actions</div>
          <div style="margin-top:8px;font-size:13px;color:var(--muted)">After parsing you can filter, search or export the metadata as JSON — stream URLs and DRM keys are ignored by default.</div>
        </div>
        <div style="margin-top:auto">
          <div style="font-weight:600;margin-bottom:6px">Import / Export</div>
          <div style="display:flex;gap:8px">
            <button id="exportJson">Export JSON</button>
            <button id="clearAll">Clear</button>
          </div>
        </div>
      </div>
    </div>

    <div style="display:flex;justify-content:space-between;align-items:center;gap:12px;margin-top:6px">
      <div class="filters">
        <select id="groupFilter" class="search">
          <option value="">All groups</option>
        </select>
        <input id="search" class="search" placeholder="Search channels" />
      </div>
      <div class="toolbar">
        <div class="pill">Channels: <span id="count">0</span></div>
      </div>
    </div>

    <div id="grid" class="grid" aria-live="polite">
      <div class="empty">No channels yet. Paste your M3U and click <strong>Parse M3U</strong>.</div>
    </div>

    <footer>
      <div class="muted">Notes: This viewer purposely <strong>does not</strong> include or expose stream URLs or DRM license keys. Use only legal/authorized stream URLs if you plan to play any content.</div>
    </footer>
  </div>

  <!-- Modal: Ask for a legal stream URL to play (user-provided) -->
  <div id="modal" class="modal" role="dialog" aria-modal="true">
    <div class="modal-card">
      <div style="display:flex;justify-content:space-between;align-items:center;margin-bottom:8px">
        <div style="font-weight:700">Play channel (paste legal stream URL)</div>
        <button id="closeModal" style="background:transparent;border:none;color:var(--muted);cursor:pointer">✕</button>
      </div>
      <div style="margin-bottom:8px" class="small">Supported: direct MP4/HLS (.m3u8). DASH/DRM streams may not play in the browser without special players and licenses.</div>
      <input id="playUrl" placeholder="https://example.com/stream.m3u8 or https://.../video.mp4" />
      <div style="display:flex;gap:8px;margin-top:10px">
        <button id="startPlay">Start</button>
        <button id="playClose" style="background:rgba(255,255,255,0.04)">Cancel</button>
      </div>
      <div id="playerWrap" style="margin-top:12px;display:none">
        <video id="player" controls style="width:100%;border-radius:8px;background:black"></video>
      </div>
    </div>
  </div>

  <script>
    // Basic M3U parser (client-side). It extracts metadata from #EXTINF lines and ignores stream URLs and KODIPROP lines.
    const parseBtn = document.getElementById('parseBtn');
    const m3uInput = document.getElementById('m3uInput');
    const grid = document.getElementById('grid');
    const groupFilter = document.getElementById('groupFilter');
    const search = document.getElementById('search');
    const count = document.getElementById('count');
    const exportJsonBtn = document.getElementById('exportJson');
    const clearAllBtn = document.getElementById('clearAll');

    let channels = [];

    function parseM3U(text){
      const lines = text.split(/\r?\n/);
      const result = [];
      for(let i=0;i<lines.length;i++){
        const line = lines[i].trim();
        if(line.startsWith('#EXTINF')){
          // example: #EXTINF:-1 tvg-id="a2z" tvg-logo="https://i.imgur.com/ftwsljN.png" group-title="Entertainment",A2Z
          const metaPart = line.replace(/^#EXTINF:[^ ]*/,'').trim();
          // split meta and display name
          const commaIndex = metaPart.indexOf(',');
          const metaAttrs = commaIndex>-1?metaPart.slice(0,commaIndex).trim():metaPart;
          const displayName = commaIndex>-1?metaPart.slice(commaIndex+1).trim():"";
          const entry = {name:displayName||'Unknown',tvgId:'',tvgLogo:'',group:'',rawMeta:metaAttrs};
          // find attributes as key="value"
          const attrRegex = /(\w+)=\"([^\"]*)\"/g;
          let m;
          while((m = attrRegex.exec(metaAttrs))){
            const k = m[1]; const v = m[2];
            if(k.toLowerCase()==='tvg-id') entry.tvgId = v;
            else if(k.toLowerCase()==='tvg-logo' || k.toLowerCase()==='group-logo') entry.tvgLogo = v;
            else if(k.toLowerCase()==='group-title' || k.toLowerCase()==='group') entry.group = v;
          }
          result.push(entry);
        }
      }
      return result;
    }

    function renderGrid(list){
      grid.innerHTML = '';
      if(list.length===0){
        grid.innerHTML = '<div class="empty">No channels found for this filter/search.</div>';
        count.textContent = '0';
        return;
      }
      list.forEach((c,idx)=>{
        const card = document.createElement('div'); card.className='card';
        const logo = document.createElement('div'); logo.className='logo';
        const img = document.createElement('img');
        img.alt = c.name + ' logo';
        img.onerror = ()=>{ img.style.display='none' };
        if(c.tvgLogo) img.src = c.tvgLogo; else img.src = '';
        logo.appendChild(img);
        const meta = document.createElement('div'); meta.className='meta';
        const title = document.createElement('div'); title.className='title'; title.textContent = c.name;
        const sub = document.createElement('div'); sub.className='sub'; sub.innerHTML = (c.group?c.group+' • ':'') + (c.tvgId?('id: '+c.tvgId):'');
        meta.appendChild(title); meta.appendChild(sub);
        const actions = document.createElement('div'); actions.className='actions';
        const playBtn = document.createElement('button'); playBtn.textContent='Play';
        playBtn.title='Play (you must provide a legal stream URL)';
        playBtn.onclick = ()=>openPlayModal(c);
        const copyBtn = document.createElement('button'); copyBtn.textContent='Copy JSON'; copyBtn.style.background='rgba(255,255,255,0.03)';
        copyBtn.onclick = ()=>navigator.clipboard.writeText(JSON.stringify(c, null, 2));
        actions.appendChild(playBtn); actions.appendChild(copyBtn);
        card.appendChild(logo); card.appendChild(meta); card.appendChild(actions);
        grid.appendChild(card);
      });
      count.textContent = list.length;
    }

    parseBtn.addEventListener('click', ()=>{
      const txt = m3uInput.value.trim();
      if(!txt){ alert('Please paste your M3U content in the textarea.'); return; }
      channels = parseM3U(txt);
      // populate groups
      const groups = Array.from(new Set(channels.map(c=>c.group||'Other'))).sort();
      groupFilter.innerHTML = '<option value="">All groups</option>' + groups.map(g=>`<option value="${escapeHtml(g)}">${escapeHtml(g)}</option>`).join('');
      renderGrid(channels);
    });

    groupFilter.addEventListener('change', applyFilters);
    search.addEventListener('input', applyFilters);

    function applyFilters(){
      const g = groupFilter.value.trim();
      const q = search.value.trim().toLowerCase();
      let filtered = channels.slice();
      if(g) filtered = filtered.filter(c=> (c.group||'').toLowerCase()===g.toLowerCase());
      if(q) filtered = filtered.filter(c=> (c.name||'').toLowerCase().includes(q) || (c.tvgId||'').toLowerCase().includes(q));
      renderGrid(filtered);
    }

    exportJsonBtn.addEventListener('click', ()=>{
      if(!channels.length){ alert('No channels to export'); return; }
      const blob = new Blob([JSON.stringify(channels, null, 2)], {type:'application/json'});
      const url = URL.createObjectURL(blob);
      const a = document.createElement('a'); a.href = url; a.download = 'm3u_metadata.json'; document.body.appendChild(a); a.click(); a.remove(); URL.revokeObjectURL(url);
    });

    clearAllBtn.addEventListener('click', ()=>{ m3uInput.value=''; channels=[]; grid.innerHTML='<div class="empty">No channels yet. Paste your M3U and click <strong>Parse M3U</strong>.</div>'; groupFilter.innerHTML='<option value="">All groups</option>'; count.textContent='0'; });

    function escapeHtml(s){ return s.replaceAll('&','&amp;').replaceAll('<','&lt;').replaceAll('>','&gt;').replaceAll('\"','&quot;'); }

    // Modal behaviour
    const modal = document.getElementById('modal');
    const playUrl = document.getElementById('playUrl');
    const startPlay = document.getElementById('startPlay');
    const playerWrap = document.getElementById('playerWrap');
    const player = document.getElementById('player');
    const closeModal = document.getElementById('closeModal');
    const playClose = document.getElementById('playClose');
    let currentChannel = null;

    function openPlayModal(channel){ currentChannel = channel; modal.classList.add('show'); playUrl.value=''; player.pause(); player.src=''; playerWrap.style.display='none'; }
    function closePlayModal(){ modal.classList.remove('show'); currentChannel=null; }
    closeModal.onclick = closePlayModal; playClose.onclick = closePlayModal;

    startPlay.addEventListener('click', ()=>{
      const url = playUrl.value.trim(); if(!url){ alert('Paste a stream URL (you must have rights to use it).'); return; }
      // try to play directly in HTML5 video
      playerWrap.style.display='block';
      player.src = url; player.play().catch(err=>{
        alert('Cannot play this stream in a plain HTML5 player. HLS/DASH or DRM streams may require special players or licensed access.');
      });
    });

    // close modal when clicking outside
    modal.addEventListener('click', (e)=>{ if(e.target===modal) closePlayModal(); });
  </script>
</body>
</html>
